<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Chiesa Apostolica in Italia - Carini</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Icone per browser e scorciatoia su schermata Home -->
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon.png">

  <style>
    :root {
      --bg: #050608;
      --card-bg: #111318;
      --accent: #fbbf24;  /* giallo tenue */
      --accent-soft: #facc15;
      --accent-muted: rgba(251, 191, 36, 0.15);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-soft: #1f2933;
      --danger: #f97373;
      --success: #4ade80;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:12px;
    }

    .app {
      width:100%;
      max-width:500px;
      background: linear-gradient(to bottom right, rgba(15, 23, 42, 0.96), rgba(3, 7, 18, 0.98));
      border-radius:20px;
      border:1px solid rgba(148, 163, 184, 0.18);
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.8);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      max-height:100vh;
    }

    header {
      display:flex;
      align-items:center;
      gap:12px;
      padding:16px 18px 10px;
      background:radial-gradient(circle at top left, rgba(251,191,36,0.12), transparent 55%);
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
    }

    .logo {
      width:44px;
      height:44px;
      border-radius:14px;
      background: radial-gradient(circle at 30% 0%, #fbbf24, transparent 50%), #020617;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(148, 163, 184, 0.4);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 10px 25px rgba(15,23,42,1);
      overflow:hidden;
    }

    .logo img {
      width:100%;
      height:100%;
      object-fit:cover;
      border-radius:14px;
    }

    .titles h1 {
      font-size:17px;
      font-weight:600;
      letter-spacing:0.02em;
      color:var(--text-main);
    }

    .titles p {
      font-size:13px;
      color:var(--text-muted);
      margin-top:2px;
    }

    .pill {
      margin-top:6px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 9px 4px;
      border-radius:999px;
      background: rgba(15, 23, 42, 0.9);
      border:1px solid rgba(55, 65, 81, 0.8);
      font-size:11px;
      color:var(--text-muted);
      text-transform:uppercase;
      letter-spacing:0.12em;
    }

    .pill span {
      width:7px;
      height:7px;
      border-radius:999px;
      background: radial-gradient(circle, var(--accent) 0, #f97316 50%, #b45309 100%);
      box-shadow:0 0 12px rgba(251,191,36,0.9);
    }

    main {
      flex:1;
      display:flex;
      flex-direction:column;
      padding:14px 16px 16px;
      overflow-y:auto;
      gap:10px;
    }

    .tabs {
      display:flex;
      background:rgba(15,23,42,0.9);
      border-radius:999px;
      padding:3px;
      border:1px solid rgba(51,65,85,0.9);
      margin-bottom:6px;
    }

    .tab {
      flex:1;
      border:none;
      border-radius:999px;
      padding:7px 0;
      font-size:12px;
      letter-spacing:0.05em;
      text-transform:uppercase;
      color:var(--text-muted);
      background:transparent;
      cursor:pointer;
      transition: all 0.2s ease;
    }

    .tab.active {
      background: radial-gradient(circle at top, rgba(251,191,36,0.16), rgba(15,23,42,0.9));
      color:var(--accent);
      font-weight:600;
      box-shadow:
        0 0 0 1px rgba(234, 179, 8, 0.6),
        0 8px 20px rgba(0,0,0,0.9);
    }

    .tab-content {
      display:none;
      flex-direction:column;
      gap:10px;
    }

    .tab-content.active {
      display:flex;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(2,6,23,1));
      border-radius:16px;
      padding:14px 14px 16px;
      border:1px solid rgba(51,65,85,0.9);
      box-shadow:
        0 14px 35px rgba(15,23,42,0.95),
        inset 0 0 0 1px rgba(15,23,42,1);
    }

    .card-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:6px;
    }

    .card-header .tag {
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:var(--text-muted);
      display:flex;
      align-items:center;
      gap:6px;
    }

    .card-header .tag::before {
      content:"";
      width:18px;
      height:1px;
      background:linear-gradient(to right, rgba(148,163,184,0.3), rgba(15,23,42,0));
    }

    .card-header .day-chip {
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.85);
      border:1px solid rgba(75,85,99,0.7);
      color:var(--text-muted);
    }

    .devotional-title {
      font-size:17px;
      font-weight:600;
      margin-bottom:4px;
      color:var(--text-main);
    }

    .reference {
      font-size:11px;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:var(--accent-soft);
      margin-bottom:6px;
    }

    .verse {
      font-size:11.5px;
      color:rgba(248,250,252,0.82);
      font-style:italic;
      border-left:2px solid rgba(251,191,36,0.6);
      padding-left:10px;
      margin-bottom:8px;
    }

    .body-text {
      font-size:13px;
      line-height:1.55;
      color:var(--text-main);
      margin-bottom:10px;
    }

    .body-text strong {
      color:var(--accent-soft);
      font-weight:600;
    }

    .next-event {
      font-size:11.5px;
      color:var(--text-muted);
      border-top:1px dashed rgba(55,65,81,0.75);
      padding-top:8px;
      margin-top:4px;
    }

    .next-event span.label {
      display:block;
      text-transform:uppercase;
      letter-spacing:0.18em;
      font-size:10px;
      color:rgba(148,163,184,0.9);
      margin-bottom:4px;
    }

    .next-event .when {
      color:var(--accent-soft);
      font-weight:500;
      margin-bottom:2px;
    }

    .next-event .where {
      color:var(--text-muted);
      font-size:11.5px;
    }

    .note-card {
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .note-card h2 {
      font-size:15px;
      font-weight:600;
      margin-bottom:2px;
    }

    .note-card p {
      font-size:13px;
      color:var(--text-muted);
      margin-bottom:4px;
    }

    .field-group {
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:4px;
    }

    .field-group label {
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:var(--text-muted);
    }

    .field-group input,
    .field-group textarea,
    .field-group select {
      background:rgba(15,23,42,0.9);
      border-radius:10px;
      border:1px solid rgba(55,65,81,0.9);
      padding:8px 10px;
      color:var(--text-main);
      font-size:13px;
      outline:none;
      transition:border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }

    .field-group input:focus,
    .field-group textarea:focus,
    .field-group select:focus {
      border-color:rgba(251,191,36,0.8);
      box-shadow:0 0 0 1px rgba(251,191,36,0.4);
      background:rgba(15,23,42,0.96);
    }

    .field-group textarea {
      resize:vertical;
      min-height:90px;
      max-height:220px;
    }

    .radio-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    .radio-pill {
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:5px 9px;
      border-radius:999px;
      border:1px solid rgba(55,65,81,0.9);
      background:rgba(15,23,42,0.9);
      font-size:11.5px;
      cursor:pointer;
      color:var(--text-muted);
    }

    .radio-pill input {
      display:none;
    }

    .radio-pill.active {
      border-color:rgba(251,191,36,0.9);
      color:var(--accent-soft);
      background:rgba(23,23,23,0.98);
      box-shadow:0 0 0 1px rgba(251,191,36,0.25);
    }

    .radio-dot {
      width:7px;
      height:7px;
      border-radius:999px;
      background:rgba(55,65,81,0.9);
    }

    .radio-pill.active .radio-dot {
      background:radial-gradient(circle, var(--accent) 0, #f97316 50%, #b45309 100%);
      box-shadow:0 0 8px rgba(251,191,36,0.9);
    }

    .btn-row {
      display:flex;
      gap:8px;
      margin-top:4px;
    }

    .btn {
      flex:1;
      border:none;
      border-radius:999px;
      padding:9px 0;
      font-size:13px;
      font-weight:500;
      cursor:pointer;
      text-align:center;
      transition:all 0.2s ease;
    }

    .btn-primary {
      background:radial-gradient(circle at top, #fbbf24, #f97316);
      color:#111827;
      box-shadow:
        0 12px 30px rgba(251,191,36,0.6),
        0 0 0 1px rgba(161,98,7,0.6);
    }

    .btn-primary:hover {
      filter:brightness(1.05);
      box-shadow:
        0 14px 34px rgba(251,191,36,0.75),
        0 0 0 1px rgba(161,98,7,0.8);
      transform:translateY(-0.5px);
    }

    .btn-secondary {
      background:rgba(15,23,42,0.95);
      color:var(--text-muted);
      border:1px solid rgba(55,65,81,0.9);
    }

    .btn-secondary:hover {
      background:rgba(15,23,42,1);
      border-color:rgba(148,163,184,0.9);
    }

    .small-note {
      font-size:11px;
      color:var(--text-muted);
      margin-top:6px;
      line-height:1.4;
    }

    .error {
      color:var(--danger);
      font-size:11.5px;
      margin-top:4px;
    }

    .success {
      color:var(--success);
      font-size:11.5px;
      margin-top:4px;
    }

    footer {
      padding:8px 16px 10px;
      font-size:11px;
      color:rgba(148,163,184,0.9);
      border-top:1px solid rgba(30,41,59,0.9);
      background:radial-gradient(circle at bottom, rgba(15,23,42,0.95), rgba(2,6,23,0.98));
      text-align:center;
    }

    footer span {
      color:var(--accent-soft);
    }

    .no-scroll {
      overflow:hidden;
    }

    @media (max-width:480px){
      main{padding:10px 10px 12px;}
      .card{padding:12px 12px 14px;}
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">
      <img src="icon.png" alt="Logo Chiesa Apostolica Carini">
    </div>
    <div class="titles">
      <h1>Chiesa Apostolica in Italia - Carini</h1>
      <p>Via Don Luigi Sturzo 188 - Carini</p>
    </div>
  </header>

  <main>
    <div class="tabs">
      <button class="tab active" data-tab="oggi">Oggi</button>
      <button class="tab" data-tab="scrivi">Scrivi</button>
      <button class="tab" data-tab="diario">Diario</button>
      <button class="tab" data-tab="eventi">Eventi</button>
      <button class="tab" data-tab="appuntamenti">Appuntamenti</button>
    </div>

    <!-- TAB OGGI -->
    <section id="tab-oggi" class="tab-content active">
      <article class="card">
        <div class="card-header">
          <div class="tag">Devocionale di oggi</div>
          <div class="day-chip" id="oggi-label"></div>
        </div>

        <h2 class="devotional-title" id="titolo-dev"></h2>
        <div class="reference" id="riferimento-dev"></div>
        <div class="verse" id="verso-dev"></div>
        <div class="body-text" id="testo-dev"></div>

        <div class="next-event" id="prossimo-evento">
          <!-- riempito via JS -->
        </div>
      </article>
    </section>

    <!-- TAB SCRIVI -->
    <section id="tab-scrivi" class="tab-content">
      <article class="card note-card">
        <h2>Scrivi cosa Dio ti sta parlando</h2>
        <p>
          Prenditi un momento di silenzio. Puoi usare questi spazi per annotare
          una parola, un versetto, qualcosa che senti nel cuore.
        </p>

        <div class="field-group">
          <label for="nome">Nome o nickname</label>
          <input id="nome" type="text" placeholder="Es: Marco, Anna, Ospite..." />
        </div>

        <div class="field-group">
          <label>In che contesto stai leggendo?</label>
          <div class="radio-row">
            <label class="radio-pill">
              <input type="radio" name="contesto" value="casa">
              <span class="radio-dot"></span> A casa
            </label>
            <label class="radio-pill">
              <input type="radio" name="contesto" value="chiesa">
              <span class="radio-dot"></span> In chiesa
            </label>
            <label class="radio-pill">
              <input type="radio" name="contesto" value="cellula">
              <span class="radio-dot"></span> In cellula / gruppo
            </label>
            <label class="radio-pill">
              <input type="radio" name="contesto" value="altro">
              <span class="radio-dot"></span> Altro
            </label>
          </div>
        </div>

        <div class="field-group">
          <label for="nota-dev">Cosa ti ha colpito oggi?</label>
          <textarea id="nota-dev" placeholder="Scrivi qui il pensiero, la preghiera o la riflessione..."></textarea>
        </div>

        <div class="btn-row">
          <button class="btn btn-secondary" id="btn-clear-nota">Pulisci</button>
          <button class="btn btn-primary" id="btn-salva-nota">Salva</button>
        </div>

        <div id="nota-feedback" class="small-note"></div>
      </article>
    </section>

    <!-- TAB DIARIO -->
    <section id="tab-diario" class="tab-content">
      <article class="card note-card">
        <h2>Il tuo diario con Dio</h2>
        <p>
          Qui troverai le note che hai scritto nei giorni precedenti
          (salvate in questo dispositivo).
        </p>

        <div id="lista-note" class="small-note">
          Caricamento note...
        </div>

        <div class="btn-row">
          <button class="btn btn-secondary" id="btn-esporta-json">Esporta</button>
          <button class="btn btn-primary" id="btn-cancella-tutto">Cancella tutto</button>
        </div>

        <div class="small-note">
          Le note sono salvate solo su questo telefono / PC.
          Se cancelli la cronologia o cambi dispositivo, i dati non saranno piÃ¹ disponibili.
        </div>
      </article>
    </section>

    <!-- TAB EVENTI -->
    <section id="tab-eventi" class="tab-content">
      <article class="card note-card">
        <h2>Eventi in chiesa</h2>
        <p>
          Qui trovi gli appuntamenti principali della comunitÃ :
          culti, studi biblici, riunioni di preghiera e attivitÃ  speciali.
        </p>

        <div id="lista-eventi" class="small-note">
          Caricamento eventi...
        </div>
      </article>
    </section>

    <!-- TAB APPUNTAMENTI -->
    <section id="tab-appuntamenti" class="tab-content">
      <article class="card note-card">
        <h2>Richiedi un appuntamento</h2>
        <p>
          Se desideri parlare con un pastore, un responsabile o chiedere preghiera
          personale, puoi inviare una richiesta.
        </p>

        <div class="field-group">
          <label for="nome-app">Nome e cognome</label>
          <input id="nome-app" type="text" placeholder="Il tuo nome" />
        </div>

        <div class="field-group">
          <label for="contatto-app">Contatto (telefono o email)</label>
          <input id="contatto-app" type="text" placeholder="Dove possiamo ricontattarti?" />
        </div>

        <div class="field-group">
          <label for="motivo-app">Motivo dell'appuntamento</label>
          <textarea id="motivo-app" placeholder="Es. colloquio, preghiera, consiglio, altro..."></textarea>
        </div>

        <div class="field-group">
          <label for="tipo-app">Con chi vorresti parlare?</label>
          <select id="tipo-app">
            <option value="">Seleziona...</option>
            <option value="pastore">Pastore</option>
            <option value="responsabile">Responsabile di area</option>
            <option value="consulenza">Consulenza / supporto</option>
            <option value="altro">Altro / non specificato</option>
          </select>
        </div>

        <div class="btn-row">
          <button class="btn btn-secondary" id="btn-clear-app">Pulisci</button>
          <button class="btn btn-primary" id="btn-invia-app">Invia richiesta</button>
        </div>

        <div id="app-feedback" class="small-note"></div>
      </article>
    </section>
  </main>

  <footer>
    Chiesa Apostolica Carini - OSA - Rhema 2025
  </footer>
</div>

<script>
  // ðŸ‘‰ URL Apps Script per note + appuntamenti
  const ENDPOINT_URL = 'https://script.google.com/macros/s/AKfycbyc5ErhYKisl11y-JGPuJrHHW6aUDxONNlfrVssTX7XxvUr4nKiqCpH7TDccp0zGoo/exec';

  // =====================
  //   TABS
  // =====================
  const tabButtons = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.dataset.tab;

      tabButtons.forEach(b => b.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));

      btn.classList.add('active');
      document.getElementById('tab-' + tab).classList.add('active');
    });
  });

  // =====================
  //   DEVOCIONALI
  // =====================

  const oggiLabel = document.getElementById('oggi-label');
  const titoloDev = document.getElementById('titolo-dev');
  const refDev    = document.getElementById('riferimento-dev');
  const versoDev  = document.getElementById('verso-dev');
  const testoDev  = document.getElementById('testo-dev');
  const prossimoEventoBox = document.getElementById('prossimo-evento');

  const devoData = [
    {
      data: '2025-12-03',
      titolo: 'Svegliati nello Spirito (Efesini 5:14)',
      riferimento: 'â€œPer questo Ã¨ detto: Â«Risvegliati, o tu che dormi, e risorgi dai morti, e Cristo ti inonderÃ  di luceÂ».â€',
      verso: 'Lo Spirito Santo oggi ti sta chiamando con urgenza: Ã¨ il momento che il tuo spirito si risvegli davvero. Non puoi continuare a vivere con quella pesantezza che ti accompagna: non Ã¨ naturale, non Ã¨ tua, non viene da Dio. Ãˆ il segnale che il tuo spirito sta chiedendo aria, presenza, luce. Il cielo sta soffiando su di te: accoglilo con sensibilitÃ  spirituale, visione, passione, vigilanza. Il Signore ti dice: â€œAlzati ora, torna nella Mia luce, guarda di nuovo con i Miei occhiâ€. Spezza oggi lâ€™indifferenza, rimuovi ciÃ² che ha spento la tua fame, ricomincia dalle cose semplici ma decisive. In quale area della tua vita stai continuando a dormire spiritualmente, pur sapendo che Dio ti sta chiamando a svegliarti?',
      evento: {
        quando: '03/12/2025 Â· 21:00',
        cosa: 'Studi',
        dove: 'Carini'
      }
    }
  ];

  function formattaDataItaliano(date) {
    const giorni = ['domenica','lunedÃ¬','martedÃ¬','mercoledÃ¬','giovedÃ¬','venerdÃ¬','sabato'];
    const mesi   = ['gennaio','febbraio','marzo','aprile','maggio','giugno','luglio','agosto','settembre','ottobre','novembre','dicembre'];
    const d = new Date(date);
    const giornoSettimana = giorni[d.getDay()];
    const giorno = String(d.getDate()).padStart(2,'0');
    const mese   = mesi[d.getMonth()];
    return `${giornoSettimana} ${giorno} ${mese} ${d.getFullYear()}`;
  }

  function mostraDevocionaleOggi() {
    const oggi = new Date();
    const isoOggi = oggi.toISOString().slice(0,10);
    const oggiTesto = formattaDataItaliano(oggi);
    oggiLabel.textContent = 'Oggi Â· ' + oggiTesto;

    const dev = devoData.find(d => d.data === isoOggi) || devoData[0];

    titoloDev.textContent = dev.titolo;
    refDev.textContent = dev.riferimento;
    versoDev.textContent = dev.verso;
    testoDev.textContent = '';

    if (dev.evento) {
      prossimoEventoBox.innerHTML = `
        <span class="label">Prossimo evento</span>
        <div class="when">${dev.evento.quando}</div>
        <div class="where">${dev.evento.cosa}<br>${dev.evento.dove}</div>
      `;
    } else {
      prossimoEventoBox.innerHTML = '';
    }
  }

  mostraDevocionaleOggi();

  // =====================
  //   NOTE LOCALI
  // =====================

  const NOTES_KEY = 'devotional_notes_v1';

  const nomeInput = document.getElementById('nome');
  const contestoRadios = document.querySelectorAll('input[name="contesto"]');
  const radioPillLabels = document.querySelectorAll('.radio-pill');
  const notaText = document.getElementById('nota-dev');
  const btnSaveNota = document.getElementById('btn-salva-nota');
  const btnClearNota = document.getElementById('btn-clear-nota');
  const notaFeedback = document.getElementById('nota-feedback');
  const listaNote = document.getElementById('lista-note');
  const btnExport = document.getElementById('btn-esporta-json');
  const btnDeleteAll = document.getElementById('btn-cancella-tutto');

  radioPillLabels.forEach(label => {
    const input = label.querySelector('input');
    label.addEventListener('click', () => {
      radioPillLabels.forEach(l => l.classList.remove('active'));
      label.classList.add('active');
      input.checked = true;
    });
  });

  function getNotes() {
    try {
      const raw = localStorage.getItem(NOTES_KEY);
      if (!raw) return [];
      return JSON.parse(raw);
    } catch(e) {
      console.error('Errore parsing note', e);
      return [];
    }
  }

  function saveNotes(notes) {
    localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
  }

  function renderNotes() {
    const notes = getNotes();
    if (!notes.length) {
      listaNote.textContent = 'Non hai ancora salvato nessuna nota. Scrivi qualcosa nella sezione "Scrivi" e salvala.';
      return;
    }
    listaNote.innerHTML = notes
      .sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp))
      .map(n => {
        const d = new Date(n.timestamp);
        const dataFormattata = d.toLocaleString('it-IT', {
          day:'2-digit', month:'2-digit', year:'numeric',
          hour:'2-digit', minute:'2-digit'
        });
        return `
          <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px dashed rgba(55,65,81,0.75);">
            <div style="font-size:11px; color:rgba(148,163,184,0.9); margin-bottom:4px;">
              ${dataFormattata} Â· ${n.nome || 'Anonimo'}${n.contesto ? ' Â· ' + n.contesto : ''}
            </div>
            <div style="font-size:13px; color:#e5e7eb; white-space:pre-wrap;">
              ${n.testo}
            </div>
          </div>
        `;
      })
      .join('');
  }

  renderNotes();

  btnSaveNota.addEventListener('click', () => {
    notaFeedback.textContent = '';
    notaFeedback.classList.remove('error','success');

    const nome = nomeInput.value.trim() || 'Anonimo';
    const contestoInput = Array.from(contestoRadios).find(r => r.checked);
    const contesto = contestoInput ? contestoInput.value : '';
    const testo = notaText.value.trim();

    if (!testo) {
      notaFeedback.textContent = 'Scrivi qualcosa prima di salvare.';
      notaFeedback.classList.add('error');
      return;
    }

    const notes = getNotes();
    const nuovaNota = {
      id: Date.now(),
      nome,
      contesto,
      testo,
      timestamp: new Date().toISOString(),
      origine: 'dev_app'
    };
    notes.push(nuovaNota);
    saveNotes(notes);
    renderNotes();

    notaFeedback.textContent = 'Nota salvata sul dispositivo.';
    notaFeedback.classList.add('success');

    notaText.value = '';

    const payload = {
      tipo: 'nota',
      nome,
      contesto,
      testo,
      timestamp: nuovaNota.timestamp
    };

    fetch(ENDPOINT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).catch(e => console.error('Errore invio a Apps Script', e));
  });

  btnClearNota.addEventListener('click', () => {
    notaText.value = '';
    notaFeedback.textContent = '';
    notaFeedback.classList.remove('error','success');
  });

  btnExport.addEventListener('click', () => {
    const notes = getNotes();
    if (!notes.length) {
      alert('Non ci sono note da esportare.');
      return;
    }
    const blob = new Blob([JSON.stringify(notes, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'devotional_notes.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  btnDeleteAll.addEventListener('click', () => {
    if (!confirm('Sei sicuro di voler cancellare tutte le note salvate su questo dispositivo?')) return;
    localStorage.removeItem(NOTES_KEY);
    renderNotes();
  });

  // =====================
  //   EVENTI (statici)
  // =====================

  const listaEventi = document.getElementById('lista-eventi');

  const eventi = [
    {
      titolo: 'Culto domenicale',
      descrizione: 'Adorazione, predicazione e comunione fraterna.',
      quando: 'Ogni domenica Â· Ore 11:00',
      dove: 'Chiesa Apostolica Carini'
    },
    {
      titolo: 'Studio biblico',
      descrizione: 'Approfondimento della Parola con domande e confronto.',
      quando: 'Ogni martedÃ¬ Â· Ore 21:00',
      dove: 'Chiesa Apostolica Carini'
    },
    {
      titolo: 'Riunione di preghiera',
      descrizione: 'Tempo dedicato alla preghiera e intercessione.',
      quando: 'Ogni giovedÃ¬ Â· Ore 21:00',
      dove: 'Chiesa Apostolica Carini'
    }
  ];

  function renderEventi() {
    if (!eventi.length) {
      listaEventi.textContent = 'Al momento non ci sono eventi programmati.';
      return;
    }
    listaEventi.innerHTML = eventi
      .map(ev => `
        <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px dashed rgba(55,65,81,0.75);">
          <div style="font-size:13px; font-weight:600; color:#e5e7eb; margin-bottom:2px;">
            ${ev.titolo}
          </div>
          <div style="font-size:12px; color:rgba(148,163,184,0.9); margin-bottom:3px;">
            ${ev.quando} Â· ${ev.dove}
          </div>
          <div style="font-size:12.5px; color:#e5e7eb;">
            ${ev.descrizione}
          </div>
        </div>
      `)
      .join('');
  }

  renderEventi();

  // =====================
  //   APPUNTAMENTI â†’ Apps Script
  // =====================

  const nomeApp = document.getElementById('nome-app');
  const contattoApp = document.getElementById('contatto-app');
  const motivoApp = document.getElementById('motivo-app');
  const tipoApp = document.getElementById('tipo-app');
  const btnClearApp = document.getElementById('btn-clear-app');
  const btnInviaApp = document.getElementById('btn-invia-app');
  const appFeedback = document.getElementById('app-feedback');

  btnClearApp.addEventListener('click', () => {
    nomeApp.value = '';
    contattoApp.value = '';
    motivoApp.value = '';
    tipoApp.value = '';
    appFeedback.textContent = '';
    appFeedback.classList.remove('error','success');
  });

  btnInviaApp.addEventListener('click', () => {
    appFeedback.textContent = '';
    appFeedback.classList.remove('error','success');

    const nome = nomeApp.value.trim();
    const contatto = contattoApp.value.trim();
    const motivo = motivoApp.value.trim();
    const tipo = tipoApp.value;

    if (!nome || !contatto || !motivo) {
      appFeedback.textContent = 'Compila tutti i campi prima di inviare.';
      appFeedback.classList.add('error');
      return;
    }

    const payload = {
      tipo: 'appuntamento',
      nome,
      contatto,
      motivo,
      categoria: tipo,
      timestamp: new Date().toISOString()
    };

    appFeedback.textContent = 'Invio in corso...';
    appFeedback.classList.remove('error','success');

    fetch(ENDPOINT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
      .then(() => {
        appFeedback.textContent = 'Richiesta inviata. Verrai ricontattato al piÃ¹ presto.';
        appFeedback.classList.add('success');
        nomeApp.value = '';
        contattoApp.value = '';
        motivoApp.value = '';
        tipoApp.value = '';
      })
      .catch(err => {
        console.error(err);
        appFeedback.textContent = 'Si Ã¨ verificato un problema durante l\'invio. Riprova piÃ¹ tardi.';
        appFeedback.classList.add('error');
      });
  });
</script>
</body>
</html>
