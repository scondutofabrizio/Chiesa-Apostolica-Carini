<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Chiesa Apostolica Carini - Ristoro giornaliero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon.png">
  <style>
    :root {
      --bg:#050608; --card:#111319; --accent:#ff8800; --accent-soft:rgba(255,136,0,0.15);
      --text:#f5f5f5; --muted:#999; --font-main:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:var(--font-main);background:radial-gradient(circle at top,#202238 0,#050608 55%);color:var(--text);min-height:100vh;}
    .app{max-width:480px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;background:rgba(0,0,0,0.55);}
    header{padding:12px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid rgba(255,255,255,0.08);background:linear-gradient(135deg,#191b25,#101019);}
    .logo{width:34px;height:34px;border-radius:12px;overflow:hidden;background:#000;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
    .logo img{width:100%;height:100%;object-fit:cover;}
    .titles h1{font-size:16px;font-weight:700;}
    .titles p{font-size:11px;color:var(--muted);margin-top:2px;}
    .pill{display:inline-flex;align-items:center;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.2);font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-top:4px;gap:4px;}
    .pill span{width:4px;height:4px;border-radius:50%;background:var(--accent);}
    main{flex:1;padding:12px 14px 16px;}
    .tabs{display:flex;gap:6px;margin-bottom:12px;background:rgba(255,255,255,0.04);border-radius:999px;padding:4px;flex-wrap:wrap;}
    .tab{flex:1 1 0;border:none;background:transparent;color:var(--muted);font-size:13px;padding:6px 8px;border-radius:999px;cursor:pointer;text-align:center;}
    .tab.active{background:var(--accent-soft);color:var(--accent);font-weight:600;}
    .card{background:var(--card);border-radius:16px;padding:14px 14px 16px;border:1px solid rgba(255,255,255,0.08);margin-bottom:14px;}
    .dev-header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px;}
    .nav-prev, .nav-today{border:none;background:transparent;border-radius:999px;cursor:pointer;font-size:11px;padding:4px 8px;}
    .nav-prev{color:var(--muted);}
    .nav-prev:hover, .nav-today:hover{background:rgba(255,255,255,0.06);}
    .nav-prev[disabled]{opacity:0.3;cursor:default;}
    .chip-date{display:inline-flex;align-items:center;gap:6px;padding:3px 9px;border-radius:999px;background:rgba(255,255,255,0.06);font-size:11px;color:var(--muted);}
    .chip-date span:first-child{width:6px;height:6px;border-radius:50%;background:var(--accent);}
    .dev-title{font-size:18px;font-weight:700;margin-bottom:4px;}
    .dev-ref{font-size:12px;color:var(--accent);margin-bottom:8px;text-transform:uppercase;letter-spacing:.08em;}
    .dev-verse{font-size:13px;color:#ccc;margin-bottom:10px;white-space:pre-line;}
    .dev-content{font-size:14px;line-height:1.5;color:#ddd;white-space:pre-line;}
    textarea{width:100%;min-height:110px;resize:vertical;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:rgba(0,0,0,0.65);color:var(--text);padding:10px;font-size:14px;outline:none;}
    textarea::placeholder{color:#666;}
    .btn-row{display:flex;justify-content:flex-end;gap:8px;margin-top:10px;}
    .btn{border:none;border-radius:999px;padding:7px 14px;font-size:13px;cursor:pointer;}
    .btn-primary{background:var(--accent);color:#111;font-weight:600;}
    .btn-ghost{background:transparent;color:var(--muted);}
    .btn-ghost:hover{background:rgba(255,255,255,0.08);}
    .small-note{font-size:11px;color:var(--muted);margin-top:6px;}
    .diary-item{padding:9px 10px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);margin-bottom:8px;background:rgba(0,0,0,0.5);cursor:pointer;}
    .diary-date{font-size:12px;color:var(--accent);margin-bottom:3px;}
    .diary-preview{font-size:13px;color:#ddd;max-height:40px;overflow:hidden;}
    .empty{text-align:center;font-size:13px;color:var(--muted);padding:14px 4px;}
    .events-list{display:flex;flex-direction:column;gap:8px;}
    .event-item{padding:10px 11px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);background:rgba(0,0,0,0.5);}
    .event-date{font-size:12px;color:var(--accent);margin-bottom:3px;}
    .event-title{font-size:14px;font-weight:600;margin-bottom:2px;}
    .event-location{font-size:12px;color:var(--muted);margin-bottom:3px;}
    .event-desc{font-size:13px;color:#ddd;margin-bottom:4px;}
    footer{padding:6px 12px 10px;font-size:10px;color:var(--muted);text-align:center;border-top:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.7);}
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo"><img src="icon.png" alt="Logo"></div>
    <div class="titles">
      <h1>Chiesa Apostolica Carini</h1>
      <p>Ristoro giornaliero</p>
      <div class="pill"><span></span> Identità · Dicembre 2025</div>
    </div>
  </header>
  <main>
    <div class="tabs">
      <button class="tab active" data-tab="oggi">Oggi</button>
      <button class="tab" data-tab="scrivi">Scrivi</button>
      <button class="tab" data-tab="diario">Diario</button>
      <button class="tab" data-tab="eventi">Eventi</button>
      <button class="tab" data-tab="appuntamenti">Appuntamenti</button>
    </div>

    <!-- OGGI -->
    <section class="card" id="tab-oggi">
      <div class="dev-header">
        <button class="nav-prev" id="prevDevoBtn" type="button">← Ieri</button>
        <div style="display:flex;align-items:center;gap:6px;">
          <div class="chip-date"><span></span><span id="todayLabel">Oggi</span></div>
          <button class="nav-today" id="todayDevoBtn" type="button">Oggi</button>
        </div>
      </div>
      <div class="dev-title" id="devTitle">Caricamento...</div>
      <div class="dev-ref" id="devRef"></div>
      <div class="dev-verse" id="devVerse"></div>
      <div class="dev-content" id="devContent"></div>

      <div class="home-next-event" id="homeNextEventCard">
        <div class="section-title" style="margin-bottom:4px;">Prossimo evento</div>
        <div id="homeNextEventInner" class="small-note">Caricamento evento...</div>
      </div>
    </section>

    <!-- SCRIVI -->
    <section class="card" id="tab-scrivi" style="display:none;">
      <div class="section-title">La mia nota di oggi</div>
      <textarea id="noteInput" placeholder="Scrivi qui la tua nota..."></textarea>
      <div class="btn-row">
        <button class="btn btn-ghost" id="clearNote">Cancella</button>
        <button class="btn btn-primary" id="saveNote">Salva nota</button>
      </div>
      <div class="small-note">Le note vengono salvate solo su questo dispositivo.</div>
    </section>

    <!-- DIARIO -->
    <section class="card" id="tab-diario" style="display:none;">
      <div class="section-title">Il mio diario</div>
      <div id="diaryList"></div>
      <div class="small-note">Tocca una nota per rileggerla e modificarla.</div>
    </section>

    <!-- EVENTI -->
    <section class="card" id="tab-eventi" style="display:none;">
      <div class="section-title">Eventi in programma</div>
      <div id="eventsList" class="events-list"></div>
    </section>

    <!-- APPUNTAMENTI -->
    <section class="card" id="tab-appuntamenti" style="display:none;">
      <div class="section-title">Richiedi un appuntamento</div>
      <input type="text" id="appFullName" class="input-text" placeholder="Nome e cognome">
      <input type="tel" id="appPhone" class="input-text" placeholder="Telefono">
      <textarea id="appReason" placeholder="Motivazione"></textarea>
      <div class="btn-row">
        <button class="btn btn-primary" id="appSubmit">Invia richiesta</button>
      </div>
    </section>
  </main>
  <footer>Chiesa Apostolica Carini - 2025</footer>
</div>

<script>
const ENDPOINT = 'https://script.google.com/macros/s/TUO_DEPLOY_ID/exec';

let devotionals=[], currentDevoDate=null;

function fetchToday() {
  fetch(ENDPOINT)
    .then(r=>r.json())
    .then(data=>{
      devotionals = data.devotional ? [data.devotional] : [];
      renderToday(data.devotional);
      renderHomeNextEvent(data.nextEvent);
      renderEvents(data.weekEvents || []);
    });
}

function renderToday(dev) {
  if(!dev) return;
  document.getElementById('devTitle').textContent = dev.titolo || '';
  document.getElementById('devRef').textContent = dev.riferimento || '';
  document.getElementById('devVerse').textContent = dev.verso || '';
  document.getElementById('devContent').textContent = dev.testo || '';
  document.getElementById('todayLabel').textContent = dev.data || 'Oggi';
}

function renderHomeNextEvent(ev) {
  const box = document.getElementById('homeNextEventInner');
  if(!ev) { box.textContent='Nessun evento in programma.'; return; }
  box.innerHTML = `<div class="home-next-event-date">${ev.data} ${ev.ora||''}</div>
                   <div class="home-next-event-title">${ev.titolo}</div>
                   ${ev.luogo?`<div class="home-next-event-loc">${ev.luogo}</div>`:''}`;
}

function renderEvents(list) {
  const container = document.getElementById('eventsList');
  container.innerHTML='';
  if(!list.length){ container.innerHTML='<div class="empty">Nessun evento disponibile.</div>'; return; }
  list.forEach(ev=>{
    const div = document.createElement('div');
    div.className='event-item';
    div.innerHTML = `<div class="event-date">${ev.data} ${ev.ora||''}</div>
                     <div class="event-title">${ev.titolo}</div>
                     ${ev.luogo?`<div class="event-location">${ev.luogo}</div>`:''}
                     ${ev.descrizione?`<div class="event-desc">${ev.descrizione}</div>`:''}`;
    container.appendChild(div);
  });
}

// Salvataggio nota
document.getElementById('saveNote').addEventListener('click',()=>{
  const text = document.getElementById('noteInput').value;
  if(!text.trim()){ alert('Scrivi qualcosa'); return; }
  const payload = { type:'response', nome:'Anonimo', data_devozionale: devotionals[0].data, testo_risposta:text };
  fetch(ENDPOINT,{method:'POST',body:JSON.stringify(payload)});
  alert('Nota inviata ✅');
});

// Invio appuntamento
document.getElementById('appSubmit').addEventListener('click',()=>{
  const fullName=document.getElementById('appFullName').value;
  const phone=document.getElementById('appPhone').value;
  const reason=document.getElementById('appReason').value;
  if(!fullName||!phone||!reason){alert('Compila tutti i campi');return;}
  const payload={type:'appointment', nome:fullName, telefono:phone, motivo:reason, data:new Date().toLocaleDateString()};
  fetch(ENDPOINT,{method:'POST',body:JSON.stringify(payload)});
  alert('Richiesta inviata ✅');
});

// Tab
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{ 
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('section.card').forEach(s=>s.style.display='none');
    document.getElementById('tab-'+btn.dataset.tab).style.display='';
  });
});

fetchToday();
</script>
</body>
</html>
