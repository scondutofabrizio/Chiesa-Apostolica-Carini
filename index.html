<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chiesa Apostolica in Italia - Carini</title>

<!-- Icona Web App -->
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="icon.png">

<style>
:root { --nero:#0a0a0a; --blu:#0f172a; --grigio:#9ca3af; --oro:#facc15; --verde:#22c55e; --bianco:#ffffff; --glass:rgba(255,255,255,0.08);}
* { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;}
html, body { min-height:100vh;}
body { background: linear-gradient(180deg, var(--nero), var(--blu)); color: var(--bianco);}

/* HEADER */
header { display:flex; align-items:center; gap:12px; padding:16px; background:var(--glass); backdrop-filter: blur(14px);}
header img { width:42px; height:42px; border-radius:14px;}
header .header-text { display:flex; flex-direction: column;}
header h1 { font-size:16px; font-weight:600;}
header .indirizzo { font-size:12px; color: var(--grigio);}

/* MAIN */
main { padding:20px; padding-bottom:140px;} /* aumentato padding-bottom per nav pi√π alta */
.card { background:var(--glass); backdrop-filter: blur(16px); border-radius:18px; padding:20px; margin-bottom:20px;}
.card h2 { color:var(--oro); margin-bottom:10px;}
.card p { line-height:1.6; color:#e5e7eb;}
.event { border-left:4px solid var(--verde); padding-left:12px; margin-bottom:14px;}
.event span { font-size:14px; color:var(--grigio);}

/* WHATSAPP */
.whatsapp-btn { display:flex; justify-content:center; align-items:center; gap:10px; background:#25D366; color:#000; padding:16px; border-radius:18px; font-size:18px; font-weight:600; text-decoration:none;}

/* PRIVATO */
#privato input { padding:10px; font-size:16px; border-radius:8px; border:none; margin-bottom:12px; width:100%;}
#privato button { padding:10px; font-size:16px; border-radius:8px; background:var(--oro); color:var(--nero); border:none; cursor:pointer; width:100%; font-weight:600;}
#privato iframe { width:100%; height:400px; border:none; margin-top:16px;}

/* FOOTER */
footer { text-align:center; padding:14px 0; font-size:13px; color:var(--grigio);}

/* NAV - aggiornata altezza e pulsanti */
nav { position:fixed; bottom:0; left:0; right:0; background:rgba(0,0,0,0.6); backdrop-filter: blur(20px); display:flex; justify-content:space-around; padding:18px 0; z-index:999;}
nav button { background:none; border:none; color:var(--bianco); font-size:16px; cursor:pointer; padding:8px 12px;}
nav button.active { color:var(--oro); border-radius:10px; background:rgba(255,255,255,0.1);}
</style>
</head>

<body>

<header>
  <img src="icon.png" alt="Logo">
  <div class="header-text">
    <h1>Chiesa Apostolica in Italia - Carini</h1>
    <div class="indirizzo">Via Don Luigi Sturzo 188</div>
  </div>
</header>

<main>

<section id="home" class="page">
  <div class="card">
    <h2>üìñ Devozionale di oggi</h2>
    <strong id="dev-rif"></strong>
    <p id="dev-testo">Caricamento...</p>
  </div>
</section>

<section id="eventi" class="page" style="display:none">
  <div class="card">
    <h2>üìÖ Eventi</h2>
    <div id="lista-eventi">Caricamento...</div>
  </div>
</section>

<section id="appuntamento" class="page" style="display:none">
  <div class="card">
    <h2>üí¨ Appuntamento</h2>
    <a class="whatsapp-btn" href="https://wa.me/393512984545?text=Ciao%20vorrei%20prendere%20un%20appuntamento%20con%20il responsabile" target="_blank">üì≤ Scrivici su WhatsApp</a>
  </div>
</section>

<section id="privato" class="page" style="display:none">
  <div class="card">
    <h2>üîí Area Privata</h2>
    <input type="password" id="password" placeholder="Inserisci la password">
    <button id="accedi">Accedi</button>
    <div id="privato-content"></div>
  </div>
</section>

</main>

<footer>
  La Chiatta - Rhema 2026
</footer>

<nav>
  <button class="active">üìñ Home</button>
  <button>üìÖ Eventi</button>
  <button>üí¨ Appuntamento</button>
  <button>üîí Privato</button>
</nav>

<script>
document.addEventListener("DOMContentLoaded", function() {

  /* NAV */
  const buttons = document.querySelectorAll('nav button');
  buttons.forEach(btn=>{
    btn.addEventListener('click', function(){
      const index = Array.from(buttons).indexOf(this);
      document.querySelectorAll('.page').forEach(p=>p.style.display="none");
      document.querySelectorAll('.page')[index].style.display="block";
      buttons.forEach(b=>b.classList.remove("active"));
      this.classList.add("active");
    });
  });

  /* CSV PARSER robusto */
  function parseCSV(text){
    const rows = [];
    const lines = text.split(/\r?\n/);
    for(const line of lines){
      if(line.trim()==="") continue;
      const values = [];
      let current="", inQuotes=false;
      for(let i=0;i<line.length;i++){
        const c=line[i];
        if(c==='\"') inQuotes = !inQuotes;
        else if(c===',' && !inQuotes){ values.push(current); current="";} 
        else current+=c;
      }
      values.push(current);
      rows.push(values);
    }
    return rows;
  }

  /* DEVOZIONALE */
  fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vRy6O7uzpvmpc1auWd1WHz1H0kOifnn6qIJBlaSiehp4tSPNu87wNDPpfMpQkbW8U5H-T-7HOXyG3Cj/pub?gid=0&single=true&output=csv")
  .then(r=>r.text())
  .then(csv=>{
    const rows = parseCSV(csv);
    const todayISO = new Date().toISOString().split("T")[0];
    const row = rows.find(r=>{
      if(!r[0]) return false;
      let sheetDate=r[0].trim();
      if(sheetDate.includes("/")){
        const parts = sheetDate.split("/");
        sheetDate = `${parts[2]}-${parts[1].padStart(2,"0")}-${parts[0].padStart(2,"0")}`;
      }
      return sheetDate===todayISO;
    });
    if(row){
      document.getElementById("dev-rif").innerText=row[1];
      document.getElementById("dev-testo").innerText=row[2];
    } else {
      document.getElementById("dev-testo").innerText="Devozionale in arrivo üôè";
    }
  });

  /* EVENTI: mostra tutto senza filtro */
  fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vRy6O7uzpvmpc1auWd1WHz1H0kOifnn6qIJBlaSiehp4tSPNu87wNDPpfMpQkbW8U5H-T-7HOXyG3Cj/pub?gid=2127508252&single=true&output=csv")
  .then(r=>r.text())
  .then(csv=>{
    const rows = parseCSV(csv);
    const box = document.getElementById("lista-eventi");
    box.innerHTML="";
    rows.forEach(r=>{
      if(!r[0]) return;
      box.innerHTML += `<div class="event"><strong>${r[1]}</strong><br><span>üìÖ ${r[0]} ‚è∞ ${r[2]} üìç ${r[3]}</span></div>`;
    });
  });

  /* PRIVATO */
  document.getElementById("accedi").addEventListener("click", function(){
    const pwd = document.getElementById("password").value.trim().toLowerCase();
    const content = document.getElementById("privato-content");
    content.innerHTML = "";
    if(pwd==="predicazione"){
      content.innerHTML = `<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT8BrQDFVM47uKogqmwFsUc7ZTBe4e4LonX_trCfOU3js3dWNLzFfEhHf-cN0S6MvyvUeQNQccGolTd/pubhtml?widget=true&headers=false"></iframe>`;
    } else if(pwd==="accoglienza"){
      content.innerHTML = `<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSb0wDucKoWuSLwCfOrcEfpZwsNn8TavwipRImiq_B0bCz61_sO8CUK1Rheb6MlEnb0xAuGEmgge7Ha/pubhtml?widget=true&headers=false"></iframe>`;
    } else {
      content.innerHTML = "<p>‚ùå Password errata</p>";
    }
  });

});
</script>

</body>
</html>
