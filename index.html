<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Ristoro Giornaliero</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#050608;color:#e5e7eb;font-family:sans-serif;padding:20px}
.card{background:#111318;padding:15px;border-radius:16px;margin-bottom:12px}
button,input,textarea{width:100%;margin-top:8px;padding:8px;border-radius:8px}
</style>
</head>
<body>

<div class="card">
  <h3 id="titolo"></h3>
  <small id="rif"></small>
  <p id="testo"></p>
  <button onclick="prev()">← Giorno prima</button>
  <button onclick="today()">Oggi</button>
</div>

<div class="card">
  <input id="nome" placeholder="Nome">
  <textarea id="nota" placeholder="Scrivi una riflessione"></textarea>
  <button onclick="sendNote()">Invia</button>
  <div id="fb"></div>
</div>

<div class="card">
  <h4>Prossimo evento</h4>
  <div id="evento"></div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbx4NT11DqLhGYpP0PZid3t-NsZn1TJjLun_ReO1jZG-Hy1QwniE-BD8qfNiUZZeCWgTFg/exec";
let d=new Date();

function ymd(dt){return dt.toISOString().slice(0,10)}

async function load(){
  const r=await fetch(API+"?data="+ymd(d));
  const j=await r.json();

  if(j.devotional){
    titolo.textContent=j.devotional.title;
    rif.textContent=j.devotional.ref;
    testo.textContent=j.devotional.content;
  } else {
    titolo.textContent="Nessun devozionale";
    rif.textContent="";
    testo.textContent="";
  }

  evento.textContent=j.nextEvent
    ? `${j.nextEvent.title} – ${j.nextEvent.data} ${j.nextEvent.time}`
    : "Nessun evento";
}

function prev(){d.setDate(d.getDate()-1);load()}
function today(){d=new Date();load()}

async function sendNote(){
  const res=await fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      type:"response",
      devotionalDate:ymd(d),
      userName:nome.value,
      noteText:nota.value
    })
  });
  const j=await res.json();
  fb.textContent=j.status==="ok"?"Inviato":"Errore";
  nota.value="";
}

load();
</script>
</body>
</html>
